/**
 * Do not edit this file it is auto-generated by io-utils / gen-api-models.
 * See https://github.com/pagopa/io-utils
 */
/* eslint-disable  */

import { withoutUndefinedValues } from "@pagopa/ts-commons/lib/types";
import {
  RequestParams,
  TypeofApiCall,
  TypeofApiParams,
  createFetchRequestForApi,
  ReplaceRequestParams
} from "@pagopa/ts-commons/lib/requests";
import { identity } from "fp-ts/lib/function";

import {
  GetPointOfSaleTransactionsT,
  getPointOfSaleTransactionsDefaultDecoder,
  GetPointOfSaleTransactionsProcessedT,
  getPointOfSaleTransactionsProcessedDefaultDecoder,
  GetProductsT,
  getProductsDefaultDecoder,
  AuthPaymentBarCodeT,
  authPaymentBarCodeDefaultDecoder,
  CapturePaymentT,
  capturePaymentDefaultDecoder,
  PreviewPaymentT,
  previewPaymentDefaultDecoder,
  DeleteTransactionT,
  deleteTransactionDefaultDecoder,
  GetTransactionPreviewPdfT,
  getTransactionPreviewPdfDefaultDecoder,
  ReversalTransactionT,
  reversalTransactionDefaultDecoder,
  RewardTransactionT,
  rewardTransactionDefaultDecoder,
  GetPointOfSaleT,
  getPointOfSaleDefaultDecoder,
  DownloadInvoiceFileT,
  downloadInvoiceFileDefaultDecoder
} from "./requestTypes";

// This is a placeholder for undefined when dealing with object keys
// Typescript doesn't perform well when narrowing a union type which includes string and undefined
// (example: "foo" | "bar" | undefined)
// We use this as a placeholder for type parameters indicating "no key"
type __UNDEFINED_KEY = "_____";

export type ApiOperation = TypeofApiCall<GetPointOfSaleTransactionsT> &
  TypeofApiCall<GetPointOfSaleTransactionsProcessedT> &
  TypeofApiCall<GetProductsT> &
  TypeofApiCall<AuthPaymentBarCodeT> &
  TypeofApiCall<CapturePaymentT> &
  TypeofApiCall<PreviewPaymentT> &
  TypeofApiCall<DeleteTransactionT> &
  TypeofApiCall<GetTransactionPreviewPdfT> &
  TypeofApiCall<ReversalTransactionT> &
  TypeofApiCall<RewardTransactionT> &
  TypeofApiCall<GetPointOfSaleT> &
  TypeofApiCall<DownloadInvoiceFileT>;

export type ParamKeys = keyof (TypeofApiParams<GetPointOfSaleTransactionsT> &
  TypeofApiParams<GetPointOfSaleTransactionsProcessedT> &
  TypeofApiParams<GetProductsT> &
  TypeofApiParams<AuthPaymentBarCodeT> &
  TypeofApiParams<CapturePaymentT> &
  TypeofApiParams<PreviewPaymentT> &
  TypeofApiParams<DeleteTransactionT> &
  TypeofApiParams<GetTransactionPreviewPdfT> &
  TypeofApiParams<ReversalTransactionT> &
  TypeofApiParams<RewardTransactionT> &
  TypeofApiParams<GetPointOfSaleT> &
  TypeofApiParams<DownloadInvoiceFileT>);

/**
 * Defines an adapter for TypeofApiCall which omit one or more parameters in the signature
 * @param ApiT the type which defines the operation to expose
 * @param K the parameter to omit. undefined means no parameters will be omitted
 */
export type OmitApiCallParams<
  ApiT,
  K extends ParamKeys | __UNDEFINED_KEY = __UNDEFINED_KEY
> = (
  op: TypeofApiCall<ApiT>
) => K extends __UNDEFINED_KEY
  ? TypeofApiCall<ApiT>
  : TypeofApiCall<ReplaceRequestParams<ApiT, Omit<RequestParams<ApiT>, K>>>;

/**
 * Defines an adapter for TypeofApiCall which omit one or more parameters in the signature
 * @param ApiT the type which defines the operation to expose
 * @param K the parameter to omit. undefined means no parameters will be omitted
 */
export type WithDefaultsT<
  K extends ParamKeys | __UNDEFINED_KEY = __UNDEFINED_KEY
> = OmitApiCallParams<
  | GetPointOfSaleTransactionsT
  | GetPointOfSaleTransactionsProcessedT
  | GetProductsT
  | AuthPaymentBarCodeT
  | CapturePaymentT
  | PreviewPaymentT
  | DeleteTransactionT
  | GetTransactionPreviewPdfT
  | ReversalTransactionT
  | RewardTransactionT
  | GetPointOfSaleT
  | DownloadInvoiceFileT,
  K
>;

/**
 * Defines a collection of api operations
 * @param K name of the parameters that the Clients masks from the operations
 */
export type Client<
  K extends ParamKeys | __UNDEFINED_KEY = __UNDEFINED_KEY
> = K extends __UNDEFINED_KEY
  ? {
      readonly getPointOfSaleTransactions: TypeofApiCall<
        GetPointOfSaleTransactionsT
      >;

      readonly getPointOfSaleTransactionsProcessed: TypeofApiCall<
        GetPointOfSaleTransactionsProcessedT
      >;

      readonly getProducts: TypeofApiCall<GetProductsT>;

      readonly authPaymentBarCode: TypeofApiCall<AuthPaymentBarCodeT>;

      readonly capturePayment: TypeofApiCall<CapturePaymentT>;

      readonly previewPayment: TypeofApiCall<PreviewPaymentT>;

      readonly deleteTransaction: TypeofApiCall<DeleteTransactionT>;

      readonly getTransactionPreviewPdf: TypeofApiCall<
        GetTransactionPreviewPdfT
      >;

      readonly reversalTransaction: TypeofApiCall<ReversalTransactionT>;

      readonly rewardTransaction: TypeofApiCall<RewardTransactionT>;

      readonly getPointOfSale: TypeofApiCall<GetPointOfSaleT>;

      readonly downloadInvoiceFile: TypeofApiCall<DownloadInvoiceFileT>;
    }
  : {
      readonly getPointOfSaleTransactions: TypeofApiCall<
        ReplaceRequestParams<
          GetPointOfSaleTransactionsT,
          Omit<RequestParams<GetPointOfSaleTransactionsT>, K>
        >
      >;

      readonly getPointOfSaleTransactionsProcessed: TypeofApiCall<
        ReplaceRequestParams<
          GetPointOfSaleTransactionsProcessedT,
          Omit<RequestParams<GetPointOfSaleTransactionsProcessedT>, K>
        >
      >;

      readonly getProducts: TypeofApiCall<
        ReplaceRequestParams<GetProductsT, Omit<RequestParams<GetProductsT>, K>>
      >;

      readonly authPaymentBarCode: TypeofApiCall<
        ReplaceRequestParams<
          AuthPaymentBarCodeT,
          Omit<RequestParams<AuthPaymentBarCodeT>, K>
        >
      >;

      readonly capturePayment: TypeofApiCall<
        ReplaceRequestParams<
          CapturePaymentT,
          Omit<RequestParams<CapturePaymentT>, K>
        >
      >;

      readonly previewPayment: TypeofApiCall<
        ReplaceRequestParams<
          PreviewPaymentT,
          Omit<RequestParams<PreviewPaymentT>, K>
        >
      >;

      readonly deleteTransaction: TypeofApiCall<
        ReplaceRequestParams<
          DeleteTransactionT,
          Omit<RequestParams<DeleteTransactionT>, K>
        >
      >;

      readonly getTransactionPreviewPdf: TypeofApiCall<
        ReplaceRequestParams<
          GetTransactionPreviewPdfT,
          Omit<RequestParams<GetTransactionPreviewPdfT>, K>
        >
      >;

      readonly reversalTransaction: TypeofApiCall<
        ReplaceRequestParams<
          ReversalTransactionT,
          Omit<RequestParams<ReversalTransactionT>, K>
        >
      >;

      readonly rewardTransaction: TypeofApiCall<
        ReplaceRequestParams<
          RewardTransactionT,
          Omit<RequestParams<RewardTransactionT>, K>
        >
      >;

      readonly getPointOfSale: TypeofApiCall<
        ReplaceRequestParams<
          GetPointOfSaleT,
          Omit<RequestParams<GetPointOfSaleT>, K>
        >
      >;

      readonly downloadInvoiceFile: TypeofApiCall<
        ReplaceRequestParams<
          DownloadInvoiceFileT,
          Omit<RequestParams<DownloadInvoiceFileT>, K>
        >
      >;
    };

/**
 * Create an instance of a client
 * @param params hash map of parameters thata define the client:
 *  - baseUrl: the base url for every api call (required)
 *  - fetchApi: an implementation of the fetch() web API, depending on the platform (required)
 *  - basePath: optional path to be appended to the baseUrl
 *  - withDefaults: optional adapter to be applied to every operation, to omit some paramenters
 * @returns a collection of api operations
 */
export function createClient<K extends ParamKeys>(params: {
  baseUrl: string;
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  fetchApi: typeof fetch;
  withDefaults: WithDefaultsT<K>;
  basePath?: string;
}): Client<K>;
export function createClient(params: {
  baseUrl: string;
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  fetchApi: typeof fetch;
  withDefaults?: undefined;
  basePath?: string;
}): Client;
export function createClient<K extends ParamKeys>({
  baseUrl,
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  fetchApi,
  withDefaults,
  basePath = "/idpay-itn/merchant-op"
}: {
  baseUrl: string;
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  fetchApi: typeof fetch;
  withDefaults?: WithDefaultsT<K>;
  basePath?: string;
}) {
  const options = {
    baseUrl,
    fetchApi
  };

  const getPointOfSaleTransactionsT: ReplaceRequestParams<
    GetPointOfSaleTransactionsT,
    RequestParams<GetPointOfSaleTransactionsT>
  > = {
    method: "get",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer
    }),
    response_decoder: getPointOfSaleTransactionsDefaultDecoder(),
    url: ({
      ["initiativeId"]: initiativeId,
      ["pointOfSaleId"]: pointOfSaleId
    }) =>
      `${basePath}/initiatives/${initiativeId}/point-of-sales/${pointOfSaleId}/transactions`,

    query: ({
      ["page"]: page,
      ["size"]: size,
      ["sort"]: sort,
      ["fiscalCode"]: fiscalCode,
      ["status"]: status,
      ["productGtin"]: productGtin
    }) =>
      withoutUndefinedValues({
        ["page"]: page,
        ["size"]: size,
        ["sort"]: sort,
        ["fiscalCode"]: fiscalCode,
        ["status"]: status,
        ["productGtin"]: productGtin
      })
  };
  const getPointOfSaleTransactions: TypeofApiCall<GetPointOfSaleTransactionsT> = createFetchRequestForApi(
    getPointOfSaleTransactionsT,
    options
  );

  const getPointOfSaleTransactionsProcessedT: ReplaceRequestParams<
    GetPointOfSaleTransactionsProcessedT,
    RequestParams<GetPointOfSaleTransactionsProcessedT>
  > = {
    method: "get",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer
    }),
    response_decoder: getPointOfSaleTransactionsProcessedDefaultDecoder(),
    url: ({
      ["initiativeId"]: initiativeId,
      ["pointOfSaleId"]: pointOfSaleId
    }) =>
      `${basePath}/initiatives/${initiativeId}/point-of-sales/${pointOfSaleId}/transactions/processed`,

    query: ({
      ["page"]: page,
      ["size"]: size,
      ["sort"]: sort,
      ["fiscalCode"]: fiscalCode,
      ["status"]: status,
      ["productGtin"]: productGtin
    }) =>
      withoutUndefinedValues({
        ["page"]: page,
        ["size"]: size,
        ["sort"]: sort,
        ["fiscalCode"]: fiscalCode,
        ["status"]: status,
        ["productGtin"]: productGtin
      })
  };
  const getPointOfSaleTransactionsProcessed: TypeofApiCall<GetPointOfSaleTransactionsProcessedT> = createFetchRequestForApi(
    getPointOfSaleTransactionsProcessedT,
    options
  );

  const getProductsT: ReplaceRequestParams<
    GetProductsT,
    RequestParams<GetProductsT>
  > = {
    method: "get",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer
    }),
    response_decoder: getProductsDefaultDecoder(),
    url: ({}) => `${basePath}/products`,

    query: ({
      ["page"]: page,
      ["size"]: size,
      ["sort"]: sort,
      ["category"]: category,
      ["eprelCode"]: eprelCode,
      ["gtinCode"]: gtinCode,
      ["productFileId"]: productFileId,
      ["productName"]: productName,
      ["status"]: status,
      ["organizationId"]: organizationId
    }) =>
      withoutUndefinedValues({
        ["page"]: page,
        ["size"]: size,
        ["sort"]: sort,
        ["category"]: category,
        ["eprelCode"]: eprelCode,
        ["gtinCode"]: gtinCode,
        ["productFileId"]: productFileId,
        ["productName"]: productName,
        ["status"]: status,
        ["organizationId"]: organizationId
      })
  };
  const getProducts: TypeofApiCall<GetProductsT> = createFetchRequestForApi(
    getProductsT,
    options
  );

  const authPaymentBarCodeT: ReplaceRequestParams<
    AuthPaymentBarCodeT,
    RequestParams<AuthPaymentBarCodeT>
  > = {
    method: "put",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer,

      "Content-Type": "application/json"
    }),
    response_decoder: authPaymentBarCodeDefaultDecoder(),
    url: ({ ["trxCode"]: trxCode }) =>
      `${basePath}/transactions/bar-code/${trxCode}/authorize`,

    body: ({ ["body"]: body }) =>
      body?.constructor?.name === "Readable" ||
      body?.constructor?.name === "ReadableStream"
        ? (body as ReadableStream)
        : body?.constructor?.name === "Buffer"
        ? (body as Buffer)
        : JSON.stringify(body),

    query: () => withoutUndefinedValues({})
  };
  const authPaymentBarCode: TypeofApiCall<AuthPaymentBarCodeT> = createFetchRequestForApi(
    authPaymentBarCodeT,
    options
  );

  const capturePaymentT: ReplaceRequestParams<
    CapturePaymentT,
    RequestParams<CapturePaymentT>
  > = {
    method: "put",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer,

      "Content-Type": "application/json"
    }),
    response_decoder: capturePaymentDefaultDecoder(),
    url: ({ ["trxCode"]: trxCode }) =>
      `${basePath}/transactions/bar-code/${trxCode}/capture`,

    body: () => "{}",

    query: () => withoutUndefinedValues({})
  };
  const capturePayment: TypeofApiCall<CapturePaymentT> = createFetchRequestForApi(
    capturePaymentT,
    options
  );

  const previewPaymentT: ReplaceRequestParams<
    PreviewPaymentT,
    RequestParams<PreviewPaymentT>
  > = {
    method: "put",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer,

      "Content-Type": "application/json"
    }),
    response_decoder: previewPaymentDefaultDecoder(),
    url: ({ ["trxCode"]: trxCode }) =>
      `${basePath}/transactions/bar-code/${trxCode}/preview`,

    body: ({ ["body"]: body }) =>
      body?.constructor?.name === "Readable" ||
      body?.constructor?.name === "ReadableStream"
        ? (body as ReadableStream)
        : body?.constructor?.name === "Buffer"
        ? (body as Buffer)
        : JSON.stringify(body),

    query: () => withoutUndefinedValues({})
  };
  const previewPayment: TypeofApiCall<PreviewPaymentT> = createFetchRequestForApi(
    previewPaymentT,
    options
  );

  const deleteTransactionT: ReplaceRequestParams<
    DeleteTransactionT,
    RequestParams<DeleteTransactionT>
  > = {
    method: "delete",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer,

      "Content-Type": "application/json"
    }),
    response_decoder: deleteTransactionDefaultDecoder(),
    url: ({ ["transactionId"]: transactionId }) =>
      `${basePath}/transactions/${transactionId}`,

    query: () => withoutUndefinedValues({})
  };
  const deleteTransaction: TypeofApiCall<DeleteTransactionT> = createFetchRequestForApi(
    deleteTransactionT,
    options
  );

  const getTransactionPreviewPdfT: ReplaceRequestParams<
    GetTransactionPreviewPdfT,
    RequestParams<GetTransactionPreviewPdfT>
  > = {
    method: "get",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer
    }),
    response_decoder: getTransactionPreviewPdfDefaultDecoder(),
    url: ({ ["transactionId"]: transactionId }) =>
      `${basePath}/transactions/${transactionId}/preview-pdf`,

    query: () => withoutUndefinedValues({})
  };
  const getTransactionPreviewPdf: TypeofApiCall<GetTransactionPreviewPdfT> = createFetchRequestForApi(
    getTransactionPreviewPdfT,
    options
  );

  const reversalTransactionT: ReplaceRequestParams<
    ReversalTransactionT,
    RequestParams<ReversalTransactionT>
  > = {
    method: "post",

    // There is a well-known issue about fetch and Content-Type header when it comes to add multipart/form-data files.
    //  reference: https://github.com/github/fetch/issues/505#issuecomment-293064470
    // The solution is to skip the Content-Type header and let fetch add it for us.
    // @ts-ignore as IRequestType would require something
    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer
    }),
    response_decoder: reversalTransactionDefaultDecoder(),
    url: ({ ["transactionId"]: transactionId }) =>
      `${basePath}/transactions/${transactionId}/reversal`,

    body: ({ ["file"]: file }) => {
      if (typeof window === "undefined")
        throw new Error(
          "File upload is only support inside a browser runtime envoronment"
        );
      const formData = new FormData();
      formData.append("file", file);
      return formData;
    },

    query: () => withoutUndefinedValues({})
  };
  const reversalTransaction: TypeofApiCall<ReversalTransactionT> = createFetchRequestForApi(
    reversalTransactionT,
    options
  );

  const rewardTransactionT: ReplaceRequestParams<
    RewardTransactionT,
    RequestParams<RewardTransactionT>
  > = {
    method: "post",

    // There is a well-known issue about fetch and Content-Type header when it comes to add multipart/form-data files.
    //  reference: https://github.com/github/fetch/issues/505#issuecomment-293064470
    // The solution is to skip the Content-Type header and let fetch add it for us.
    // @ts-ignore as IRequestType would require something
    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer
    }),
    response_decoder: rewardTransactionDefaultDecoder(),
    url: ({ ["transactionId"]: transactionId }) =>
      `${basePath}/transactions/${transactionId}/reward`,

    body: ({ ["file"]: file }) => {
      if (typeof window === "undefined")
        throw new Error(
          "File upload is only support inside a browser runtime envoronment"
        );
      const formData = new FormData();
      formData.append("file", file);
      return formData;
    },

    query: () => withoutUndefinedValues({})
  };
  const rewardTransaction: TypeofApiCall<RewardTransactionT> = createFetchRequestForApi(
    rewardTransactionT,
    options
  );

  const getPointOfSaleT: ReplaceRequestParams<
    GetPointOfSaleT,
    RequestParams<GetPointOfSaleT>
  > = {
    method: "get",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer
    }),
    response_decoder: getPointOfSaleDefaultDecoder(),
    url: ({ ["merchantId"]: merchantId, ["pointOfSaleId"]: pointOfSaleId }) =>
      `${basePath}/${merchantId}/point-of-sales/${pointOfSaleId}`,

    query: () => withoutUndefinedValues({})
  };
  const getPointOfSale: TypeofApiCall<GetPointOfSaleT> = createFetchRequestForApi(
    getPointOfSaleT,
    options
  );

  const downloadInvoiceFileT: ReplaceRequestParams<
    DownloadInvoiceFileT,
    RequestParams<DownloadInvoiceFileT>
  > = {
    method: "get",

    headers: ({ ["Bearer"]: Bearer }) => ({
      Authorization: Bearer
    }),
    response_decoder: downloadInvoiceFileDefaultDecoder(),
    url: ({
      ["pointOfSaleId"]: pointOfSaleId,
      ["transactionId"]: transactionId
    }) => `${basePath}/${pointOfSaleId}/transactions/${transactionId}/download`,

    query: () => withoutUndefinedValues({})
  };
  const downloadInvoiceFile: TypeofApiCall<DownloadInvoiceFileT> = createFetchRequestForApi(
    downloadInvoiceFileT,
    options
  );

  return {
    getPointOfSaleTransactions: (withDefaults || identity)(
      getPointOfSaleTransactions
    ),
    getPointOfSaleTransactionsProcessed: (withDefaults || identity)(
      getPointOfSaleTransactionsProcessed
    ),
    getProducts: (withDefaults || identity)(getProducts),
    authPaymentBarCode: (withDefaults || identity)(authPaymentBarCode),
    capturePayment: (withDefaults || identity)(capturePayment),
    previewPayment: (withDefaults || identity)(previewPayment),
    deleteTransaction: (withDefaults || identity)(deleteTransaction),
    getTransactionPreviewPdf: (withDefaults || identity)(
      getTransactionPreviewPdf
    ),
    reversalTransaction: (withDefaults || identity)(reversalTransaction),
    rewardTransaction: (withDefaults || identity)(rewardTransaction),
    getPointOfSale: (withDefaults || identity)(getPointOfSale),
    downloadInvoiceFile: (withDefaults || identity)(downloadInvoiceFile)
  };
}
